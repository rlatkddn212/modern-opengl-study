# 쉐이더와 프로그램

-----------------------

### 쉐이더 개요

- C언어와 유사한 언어이다. 
- 행렬과 벡터 타입이 기본 타입으로 존재한다. 
- 대규모 병렬 실행되는 언어이다.
- 재귀 호출이 허용되지 않는다.
- 부동소수점 정밀도 사양이 IEEE 표준을 엄격히 준수하지 않는다.



#### 데이터 타입

- 스칼라 타입, 벡터, 행렬, 배열, 구조체 타입들이 있다.
- 스칼라 타입의 경우 C 언어의 타입들과 비슷하다. 일부 다른 점이 있다.
  - short, char는 지원 되지 않는다.
  - 포인터나 64비트 정수 타입을 지원하지 않는다. (long long)
  - GLSL의 경우 IEEE-754 표준을 엄격히 준수 하지 않는다. (그래도 정밀도는 충분하다.)
  - 0으로 나눌 경우 오류를 띄우지 않는다.
- 벡터 타입의 경우 스위즐링 가능, 배열처럼 접근 가능, x,y,z,w / s,t,p,q/ r,g,b,a 로 접근가능하다.
  - 스위즐링은 v.xxx, v.zyx 등으로 접근하는 방법이다.
- 행렬 타입의 경우 배열 처럼 접근 가능하다.
  - typedef vec4 mat4[4]; 라고 보면된다.
- GLSL은 다차원 배열을 지원하지 않지만, 배열의 배열은 가능하다.
  - C 처럼 다차원 배열을 사용하면 안된다. 차이가 있다!
  - 배열의 크기는 length() 메서드로 얻을 수 있다.



#### 내장 함수

- 함수 오버로딩을 지원한다.
- 내장 행렬 함수

|함수|설명|
|---|---|
|matrixCompMult|두 행렬 간에 요소 단위의 곱셈 수행|
|transpose|행렬을 전치 시킨다.|
|inverse|역행렬을 구한다.|
|determinant|행렬식(det)을 구한다.|
|||


- 내장 벡터 함수


|함수|설명|
|---|---|
|outerProduct|두 벡터의 외적을 수행한다.|
|lessThan, ...|요소별 비교를 한다.|
|normalize|벡터를 길이가 1인 벡터로 정규화한다. (벡터의 길이로 나눈다.)|
|any, all|부울 벡터에 대한 검사를 수행|
|distance|벡터 시작점 끝점 사이 거리|
|dot, cross|내적과 외적을 계산한다.|
|reflect, refract|반사와 굴절을 계산한다.|
|faceforward|평면이 뷰 방향에 대해 정면 방향인지 검사한다.|

- 내장 수학 함수


|함수|설명|
|---|---|
|abs, sign, ceil, floor...|C 표준 수학 함수와 동일하게 동작한다.|
|roundEven|가장 가까운 짝수 정수로 반올림한다.|
|clamp|특정 값에 지정 범위로 값을 제한 시킨다.|
|mix|두 입력에 대한 선형 보간을 수행한다.|
|step|두 입력에 대해 계단 함수를 생성한다. (0, 혹은 1의 값을 반환)|
|smoothstep|두 입력에 대해 허밋 곡선 보간을 수행한다.|
|fma|a*b +c 를 수행한다. 정밀도가 직접 계산한 것보다 높다고한다..|
|uaddCarray, usubBorrow|큰 정수에 사용하는 덧셈 뺄셈 연산|
|imulExtended, umulExtended|두 정수를 곱한 후 64 비트 결과 값을 만들어 낸다.|
|sin, cos, // exp, pow|삼각함수, 지수함수를 지원한다.|

- 내장 데이터 처리 함수
  - 데이터 내부를 드려다 보기 위한 함수


|함수|설명|
|---|---|
|frexp|지수부와 가수부를 분리해서 얻을 수 있다.|
|ldexp|지수와 가수부를 통해 새로운 부동소수점을 만든다.|
|||
|||
|||





-------------------------------------

### 프로그램 컴파일, 링킹, 테스트

- 쉐이더 코드는 바이너리 형태로 컴파일 후 링크 시켜서 그래픽스 파이프라인에서 동작할 수 있도록한다.
- 컴파일, 링크 등에서 오류가 있는지 검출하는 몇가지 방법을 제공해준다.



#### 컴파일러에서 정보 얻기

 

[함수]

- glGetShaderiv
  - 설명 : 쉐이더 컴파일 결과를 알 수 있다.
  - shader : 쉐이더 객체의 이림
  - pname : 결과를 넣어줄 변수의 주소 주로 GL_COMPILE_STATUS, GL_INFO_LOG_LENGTH 가 사용된다.
  - params : 결과 값이 반환된다.



#### 링커에서 정보 얻기



[함수]

- glGetProgramiv

  - 설명 : 쉐이더 프로그램의 링크 결과를 알 수 있다.
  - 인자는 glGetShaderiv와 비슷하다.

  

#### 분리 프로그램



#### 쉐이더 서브 루틴



#### 프로그램 바이너리

- glProgramParameteri 함수를 사용하여 컴파일된 바이너리를 얻을 수 있다.
  - GL_PROGRAM_BINARY_RETRIEVABLE_HINT 를 pname 인자에 넣는다.
  - 이 바이너리를 디스크에 저장했다가 사용할 수 도 있다. 그렇게 하면 런타임 중 쉐이더 컴파일에 드는 비용이 줄어든다.
  - opengl 드라이브 제작 업체에 따라 바이너리가 달라지기 때문에 주의가 필요하다.



예제 프로젝트 C06_DebugShader



---------------------------